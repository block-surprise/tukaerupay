<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ヒトコトモンスターズ - 最小プレイアブル</title>
  <meta name="theme-color" content="#1f4aa9" />
  <!-- OGP（必要なら差し替え） -->
  <meta property="og:title" content="ヒトコトモンスターズ" />
  <meta property="og:description" content="あなたの“ひとこと”がモンスターになる。言葉を合成して育て、詩のバトルへ。" />
  <meta property="og:image" content="/icons/ogp.png" />

  <style>
    :root{
      --bg:#0f1a2f; --panel:#121f3b; --accent:#5ea7ff; --soft:#a5c8ff; --warn:#ffb74d;
      --ok:#7cd992; --text:#eaf2ff; --muted:#a9b7d9;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: "Inter", "Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
      background: radial-gradient(1200px at 50% 0%, #17264d, var(--bg));
      color:var(--text);
    }
    header{
      padding:16px 20px; border-bottom:1px solid rgba(255,255,255,.06); backdrop-filter:saturate(140%) blur(6px);
      position:sticky; top:0; background:linear-gradient(180deg, rgba(18,31,59,.7), rgba(18,31,59,.3));
      z-index:10;
    }
    header h1{margin:0; font-size:18px; letter-spacing:.04em}
    header small{color:var(--muted)}
    main{max-width:980px; margin:26px auto; padding:0 16px}
    .grid{display:grid; grid-template-columns:1fr; gap:16px}
    @media(min-width:960px){ .grid{ grid-template-columns: 340px 1fr; } }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:16px;
      box-shadow:0 8px 28px rgba(0,0,0,.35);
    }
    .card h2{margin:0 0 12px; font-size:16px}
    .input-row{display:flex; gap:8px; margin:10px 0 4px}
    input[type=text]{
      flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
      background:#0f1a2f; color:var(--text); outline:none;
    }
    button{
      appearance:none; border:none; border-radius:10px; padding:10px 14px; cursor:pointer;
      background:linear-gradient(180deg, var(--accent), #3577e5); color:white; font-weight:600;
      box-shadow:0 6px 16px rgba(53,119,229,.35); transition:transform .06s ease, filter .2s;
    }
    button:hover{filter:brightness(1.08)}
    button:active{transform:translateY(1px)}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    .tag{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.08); color:var(--soft); border:1px solid rgba(255,255,255,.12);
      font-size:12px;
    }
    .monster{
      display:flex; align-items:center; gap:16px; padding:12px; border-radius:12px;
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
    }
    .orb{
      width:84px; height:84px; border-radius:50%;
      background:radial-gradient(110px at 30% 30%, #84b6ff 15%, #2b5fd7 55%, #14285b 80%);
      box-shadow:inset 0 0 22px rgba(255,255,255,.22), 0 12px 30px rgba(46,110,230,.45);
      position:relative; overflow:hidden;
    }
    .orb::after{
      content:""; position:absolute; inset:-30% -30% auto auto; width:120%; height:120%;
      background:radial-gradient(200px at 70% 15%, rgba(255,255,255,.18), transparent 60%);
      transform:rotate(12deg);
    }
    .stat{display:flex; gap:10px; color:var(--muted); font-size:12px}
    .stat b{color:var(--text)}
    .log{font-size:13px; color:var(--muted); line-height:1.7}
    .divider{height:1px; background:rgba(255,255,255,.08); margin:10px 0}
    .list{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:10px}
    .list .item{padding:10px; border:1px solid rgba(255,255,255,.1); border-radius:12px; background:rgba(255,255,255,.04)}
    .item h3{margin:0 0 6px; font-size:14px}
    .small{font-size:12px; color:var(--muted)}
    .danger{background:linear-gradient(180deg, #ff7c4d, #e05b2b)}
    .secondary{background:linear-gradient(180deg,#6c7bd9,#4352b6)}
  </style>
</head>
<body>
  <header>
    <h1>ヒトコトモンスターズ <small>最小プレイアブル</small></h1>
  </header>

  <main class="grid">
    <!-- 左：生成・育成 -->
    <section class="card">
      <h2>言葉合成でモンスター生成</h2>
      <div class="input-row">
        <input id="w1" type="text" placeholder="例）静けさ" />
        <input id="w2" type="text" placeholder="例）鋭さ" />
        <button id="btnGen">生成</button>
      </div>
      <div class="row">
        <span class="tag">候補: やさしさ</span>
        <span class="tag">光</span>
        <span class="tag">孤独</span>
        <span class="tag">余白</span>
        <span class="tag">情熱</span>
      </div>

      <div id="monsterBox" class="monster" style="display:none;">
        <div class="orb" aria-hidden="true"></div>
        <div>
          <div class="stat"><b id="mName">—</b> <span id="mAttrs"></span></div>
          <div class="stat">Lv <b id="mLv">1</b> / HP <b id="mHp">30</b> / ATK <b id="mAtk">7</b> / DEF <b id="mDef">4</b></div>
          <div class="row" style="margin-top:8px;">
            <button id="btnFeed" class="secondary">言葉を食べさせる</button>
            <button id="btnSave">図鑑に保存</button>
          </div>
          <div class="divider"></div>
          <div id="mLog" class="log">“ひとこと”が形を得て、静かに息づき始めた。</div>
        </div>
      </div>
    </section>

    <!-- 右：バトル・図鑑 -->
    <section class="card">
      <h2>簡易バトル</h2>
      <div class="monster">
        <div class="orb"></div>
        <div>
          <div class="stat"><b id="eName">影のカケラ</b> <span id="eAttrs">不安 / 混沌</span></div>
          <div class="stat">HP <b id="eHp">28</b> / ATK <b id="eAtk">6</b> / DEF <b id="eDef">3</b></div>
          <div class="row" style="margin-top:8px;">
            <button id="btnAttack">詩の一撃</button>
            <button id="btnHeal" class="secondary">癒しの言葉</button>
            <button id="btnReset" class="danger">バトルリセット</button>
          </div>
          <div class="divider"></div>
          <div id="bLog" class="log">塔のふもとで、影がこちらを見ている。</div>
        </div>
      </div>

      <div class="divider"></div>
      <h2>詩の図鑑</h2>
      <div id="dex" class="list"></div>
      <div class="small">ローカル保存（ブラウザのローカルストレージ）に記録されます。</div>
    </section>
  </main>

  <script>
    // ---- Utility ----
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const sanitize = (s) => (s || "").trim().slice(0, 16);

    // ---- Attribute system (emotion/essence) ----
    const EMOTIONS = ["やさしさ","怒り","静けさ","不安","情熱","孤独","光","影","余白","鋭さ"];
    const PAIRS = {
      "やさしさ":"癒し",
      "怒り":"爆ぜる",
      "静けさ":"静刃",
      "不安":"ざわめき",
      "情熱":"焔詩",
      "孤独":"孤光",
      "光":"黎明",
      "影":"幽韻",
      "余白":"間奏",
      "鋭さ":"刃歌"
    };
    const ADV = ["しずかに","ひそやかに","つよく","やわらかく","きらめいて","淡く","深く","鋭く","やさしく","とどろいて"];

    // ---- State ----
    const state = {
      monster: null,
      enemy: { name:"影のカケラ", attrs:["不安","混沌"], hp:28, atk:6, def:3 },
      dex: JSON.parse(localStorage.getItem("hitoDex") || "[]")
    };

    // ---- Generation ----
    function generateMonster(w1, w2){
      const a = sanitize(w1);
      const b = sanitize(w2);
      if(!a || !b){ alert("言葉を2つ入力してください"); return; }
      const attrs = [a, b];
      const baseName = (PAIRS[a] || PAIRS[b]) || (a.slice(0,2)+b.slice(0,2));
      const name = baseName;
      const seed = (a.length * 37 + b.length * 53) % 100;
      const lv = 1;
      const hp = 26 + (seed % 8);
      const atk = 6 + (seed % 5);
      const def = 3 + (seed % 4);
      state.monster = { name, attrs, lv, hp, atk, def, maxHp:hp };
      renderMonster();
      logM(`「${a}」と「${b}」がまじりあい、${name} が生まれた。`);
    }

    function feedMonster(){
      if(!state.monster){ alert("まずモンスターを生成してください"); return; }
      const w = pick(EMOTIONS);
      const gain = 1 + Math.floor(Math.random()*3);
      state.monster.lv += 1;
      state.monster.atk += gain;
      state.monster.def += Math.max(1, gain-1);
      state.monster.maxHp += 2;
      state.monster.hp = clamp(state.monster.hp + 2, 0, state.monster.maxHp);
      logM(`${pick(ADV)}、"${w}" を食べて力が満ちた。 ATK+${gain}, DEF+${Math.max(1, gain-1)}, HP+2`);
      renderMonster();
    }

    // ---- Battle ----
    function attack(){
      if(!state.monster){ alert("まずモンスターを生成してください"); return; }
      const m = state.monster, e = state.enemy;
      const base = m.atk + Math.floor(Math.random()*4);
      const dmg = clamp(base - e.def, 1, 99);
      e.hp = clamp(e.hp - dmg, 0, 999);
      logB(`【詩の一撃】${pick(ADV)}、${m.name} は言葉を放った。 → ${e.name} に ${dmg} ダメージ`);
      renderBattle();
      if(e.hp<=0){
        logB(`影はほどけて消えた。静寂が戻る。`);
      }
    }
    function heal(){
      if(!state.monster){ alert("まずモンスターを生成してください"); return; }
      const m = state.monster;
      const heal = 4 + Math.floor(Math.random()*4);
      m.hp = clamp(m.hp + heal, 0, m.maxHp);
      logB(`【癒しの言葉】${pick(ADV)}、${m.name} の心がやわらいだ。 → HP +${heal}`);
      renderMonster();
    }
    function resetBattle(){
      state.enemy = { name:"影のカケラ", attrs:["不安","混沌"], hp:28, atk:6, def:3 };
      document.getElementById("bLog").innerText = "塔のふもとで、影がこちらを見ている。";
      renderBattle();
    }

    // ---- Dex ----
    function saveDex(){
      if(!state.monster){ alert("まずモンスターを生成してください"); return; }
      const m = state.monster;
      const entry = {
        name: m.name, attrs: m.attrs, lv: m.lv,
        atk: m.atk, def: m.def, hp: m.hp, maxHp: m.maxHp,
        poem: `${pick(ADV)}、${m.name} は静かに息づく。`
      };
      state.dex.push(entry);
      localStorage.setItem("hitoDex", JSON.stringify(state.dex));
      renderDex();
      logM("図鑑に保存しました。");
    }

    // ---- Rendering ----
    function renderMonster(){
      const box = document.getElementById("monsterBox");
      box.style.display = "flex";
      document.getElementById("mName").innerText = state.monster.name;
      document.getElementById("mAttrs").innerText = state.monster.attrs.join(" / ");
      document.getElementById("mLv").innerText = state.monster.lv;
      document.getElementById("mHp").innerText = state.monster.hp;
      document.getElementById("mAtk").innerText = state.monster.atk;
      document.getElementById("mDef").innerText = state.monster.def;
    }
    function renderBattle(){
      document.getElementById("eName").innerText = state.enemy.name;
      document.getElementById("eAttrs").innerText = state.enemy.attrs.join(" / ");
      document.getElementById("eHp").innerText = state.enemy.hp;
      document.getElementById("eAtk").innerText = state.enemy.atk;
      document.getElementById("eDef").innerText = state.enemy.def;
    }
    function renderDex(){
      const root = document.getElementById("dex");
      root.innerHTML = state.dex.map(d => `
        <div class="item">
          <h3>${escapeHtml(d.name)}</h3>
          <div class="small">${escapeHtml(d.attrs.join(" / "))}</div>
          <div class="small">Lv ${d.lv} / HP ${d.hp}/${d.maxHp} / ATK ${d.atk} / DEF ${d.def}</div>
          <div class="small">${escapeHtml(d.poem)}</div>
        </div>
      `).join("");
    }
    function logM(msg){ document.getElementById("mLog").innerText = msg; }
    function logB(msg){ document.getElementById("bLog").innerText = msg; }
    function escapeHtml(s){
      return (s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // ---- Events ----
    document.getElementById("btnGen").addEventListener("click", () => {
      generateMonster(document.getElementById("w1").value, document.getElementById("w2").value);
    });
    document.getElementById("btnFeed").addEventListener("click", feedMonster);
    document.getElementById("btnSave").addEventListener("click", saveDex);
    document.getElementById("btnAttack").addEventListener("click", attack);
    document.getElementById("btnHeal").addEventListener("click", heal);
    document.getElementById("btnReset").addEventListener("click", resetBattle);

    // ---- Init ----
    renderDex();
    renderBattle();
  </script>
</body>
</html>
